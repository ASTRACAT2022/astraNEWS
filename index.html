<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Digital Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.9/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #e0e0e0;
      font-family: 'Arial', sans-serif;
      overflow: hidden;
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
    }
    .neon-glow {
      box-shadow: 0 0 10px #00f6ff, 0 0 20px #00f6ff;
    }
    .ticker {
      white-space: nowrap;
      overflow: hidden;
      animation: ticker 20s linear infinite;
    }
    @keyframes ticker {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Function to fetch and parse weather data with retry
    async function fetchMoscowWeather(maxRetries = 3) {
      for (let attempt = 1; attempt <= maxRetries; attempt++) {
        try {
          const corsProxy = 'https://corsproxy.io/?';
          const url = `${corsProxy}${encodeURIComponent('https://www.gismeteo.ru/weather-moscow-4368/')}`;
          const response = await fetch(url, {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
          });
          if (!response.ok) throw new Error('Network response was not ok');

          const text = await response.text();
          const parser = new DOMParser();
          const doc = parser.parseFromString(text, 'text/html');

          // Extract temperature and condition (update selectors based on GISMETEO's actual structure)
          const tempElement = doc.querySelector('.temperature .value');
          const conditionElement = doc.querySelector('.condition');

          const temperature = tempElement ? tempElement.textContent.trim() : 'N/A';
          const condition = conditionElement ? conditionElement.textContent.trim() : 'N/A';

          return { temp: temperature, condition: condition };
        } catch (error) {
          console.error(`Attempt ${attempt} failed:`, error);
          if (attempt === maxRetries) {
            return { temp: 'Ошибка', condition: 'Не удалось загрузить' };
          }
          // Wait 1 second before retrying
          await new Promise(resolve => setTimeout(resolve, 1000));
        }
      }
    }

    // Main Dashboard Component
    function Dashboard() {
      const [time, setTime] = useState(new Date());
      const [weather, setWeather] = useState({ temp: 'Загрузка...', condition: 'Загрузка...' });
      const [notifications, setNotifications] = useState('Добро пожаловать на цифровую панель!');

      useEffect(() => {
        // Update time every second
        const timer = setInterval(() => setTime(new Date()), 1000);

        // Fetch weather data on mount
        fetchMoscowWeather().then(data => setWeather(data));

        // Refresh weather every 30 minutes
        const weatherInterval = setInterval(() => {
          fetchMoscowWeather().then(data => setWeather(data));
        }, 30 * 60 * 1000);

        // Simulate notifications update
        setTimeout(() => setNotifications('Новое событие: совещание в 14:00'), 10000);

        return () => {
          clearInterval(timer);
          clearInterval(weatherInterval);
        };
      }, []);

      return (
        <div className="min-h-screen p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          {/* Time/Date Widget */}
          <div className="glass-effect p-6 rounded-lg neon-glow">
            <h1 className="text-5xl font-bold text-cyan-300">
              {time.toLocaleTimeString()}
            </h1>
            <p className="text-xl text-gray-300 mt-2">
              {time.toLocaleDateString('ru-RU', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
            </p>
          </div>

          {/* Weather Widget */}
          <div className="glass-effect p-6 rounded-lg">
            <h2 className="text-2xl font-semibold text-cyan-300">Погода в Москве</h2>
            <p className="text-3xl mt-2">{weather.temp}</p>
            <p className="text-xl text-gray-300">{weather.condition}</p>
          </div>

          {/* Better Uptime Status */}
          <div className="glass-effect p-6 rounded-lg">
            <h2 className="text-2xl font-semibold text-cyan-300">Статус экосистемы</h2>
            <iframe
              src="https://astracat-inc.betteruptime.com/badge?theme=dark"
              width="250"
              height="30"
              frameBorder="0"
              scrolling="no"
              style={{ colorScheme: 'normal' }}
              title="Better Uptime Status"
            ></iframe>
          </div>

          {/* Camera Stream */}
          <div className="glass-effect p-6 rounded-lg">
            <h2 className="text-2xl font-semibold text-cyan-300">Камера</h2>
            <iframe
              src="https://webcams.org.ru/js/player/playerjs.html?file=...&autoplay=1"
              className="w-full h-48 mt-2"
              title="Camera Stream"
              allow="autoplay"
            ></iframe>
          </div>

          {/* Notifications Ticker */}
          <div className="glass-effect p-4 rounded-lg col-span-1 md:col-span-2 lg:col-span-4">
            <p className stampa="text-lg ticker text-cyan-300">{notifications}</p>
          </div>
        </div>
      );
    }

    // Admin Panel Component
    function AdminPanel() {
      const [screens, setScreens] = useState([
        { id: 1, name: 'Экран 1', status: 'Онлайн' },
        { id: 2, name: 'Экран 2', status: 'Офлайн' },
      ]);
      const [content, setContent] = useState('');
      const [events, setEvents] = useState([]);

      const handleContentUpdate = () => {
        alert('Контент обновлен: ' + content);
      };

      const addEvent = () => {
        setEvents([...events, { id: Date.now(), title: 'Новое событие', date: new Date().toLocaleDateString() }]);
      };

      return (
        <div className="min-h-screen p-4">
          <h1 className="text-3xl font-bold text-cyan-300 mb-4">Админ-панель</h1>

          {/* Screen Monitoring */}
          <div className="glass-effect p-6 rounded-lg mb-4">
            <h2 className="text-2xl font-semibold text-cyan-300">Мониторинг экранов</h2>
            <ul className="mt-2">
              {screens.map(screen => (
                <li key={screen.id} className="text-lg">
                  {screen.name}: <span className={screen.status === 'Онлайн' ? 'text-green-400' : 'text-red-400'}>{screen.status}</span>
                </li>
              ))}
            </ul>
          </div>

          {/* Content Management */}
          <div className="glass-effect p-6 rounded-lg mb-4">
            <h2 className="text-2xl font-semibold text-cyan-300">Управление контентом</h2>
            <textarea
              className="w-full p-2 mt-2 bg-transparent border border-gray-500 rounded text-white"
              value={content}
              onChange={(e) => setContent(e.target.value)}
              placeholder="Введите новый контент"
            ></textarea>
            <button
              className="mt-2 px-4 py-2 bg-cyan-500 text-white rounded hover:bg-cyan-600"
              onClick={handleContentUpdate}
            >
              Обновить контент
            </button>
          </div>

          {/* Event Calendar */}
          <div className="glass-effect p-6 rounded-lg">
            <h2 className="text-2xl font-semibold text-cyan-300">Календарь событий</h2>
            <button
              className="mt-2 px-4 py-2 bg-cyan-500 text-white rounded hover:bg-cyan-600"
              onClick={addEvent}
            >
              Добавить событие
            </button>
            <ul className="mt-2">
              {events.map(event => (
                <li key={event.id} className="text-lg">
                  {event.title} - {event.date}
                </li>
              ))}
            </ul>
          </div>
        </div>
      );
    }

    // App Component with Routing
    function App() {
      const [isAdmin, setIsAdmin] = useState(window.location.pathname === '/admin');

      return isAdmin ? <AdminPanel /> : <Dashboard />;
    }

    // Render the App
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
